"use strict";const E=require("node:events"),T=require("node:process"),R=require("crypto"),F=require("node:https"),A=require("node:http"),_=require("node:fs");require("node:crypto");require("electron");class D{ListenerMap;WrapperSession;ListenerManger=new Map;EventTask=new Map;constructor(){}createProxyDispatch(e){const t=this;return new Proxy({},{get(n,s,o){return typeof n[s]>"u"?(...r)=>{t.DispatcherListener.apply(t,[e,s,...r]).then()}:Reflect.get(n,s,o)}})}init({ListenerMap:e,WrapperSession:t}){this.ListenerMap=e,this.WrapperSession=t}CreatEventFunction(e){const t=e.split("/");if(t.length>1){const n="get"+t[0].replace("NodeIKernel",""),s=t[1],o=this.WrapperSession[n]();let r=o[s];return r=r.bind(o),r||void 0}}CreatListenerFunction(e,t=""){const n=this.ListenerMap[e];let s=this.ListenerManger.get(e+t);if(!s&&n){s=new n(this.createProxyDispatch(e));const o=e.match(/^NodeIKernel(.*?)Listener$/)[1],r="NodeIKernel"+o+"Service/addKernel"+o+"Listener";this.CreatEventFunction(r)(s),this.ListenerManger.set(e+t,s)}return s}async DispatcherListener(e,t,...n){this.EventTask.get(e)?.get(t)?.forEach((s,o)=>{if(s.createtime+s.timeout<Date.now()){this.EventTask.get(e)?.get(t)?.delete(o);return}s.checker&&s.checker(...n)&&s.func(...n)})}async CallNoListenerEvent(e="",t=3e3,...n){return new Promise(async(s,o)=>{const r=this.CreatEventFunction(e);let i=!1;setTimeout(()=>{i||o(new Error("NTEvent EventName:"+e+" timeout"))},t);const l=await r(...n);i=!0,s(l)})}async CallNormalEvent(e="",t="",n=1,s=3e3,o,...r){return new Promise(async(i,l)=>{const a=R.randomUUID();let g=0,u,p={};const d=()=>{g==0?l(new Error("NTEvent EventName:"+e+" ListenerName:"+t+" timeout")):i([p,...u])},y=setTimeout(d,s),f=t.split("/"),h=f[0],v=f[1],C={timeout:s,createtime:Date.now(),checker:o,func:(...P)=>{g++,u=P,g>=n&&(clearTimeout(y),d())}};this.EventTask.get(h)||this.EventTask.set(h,new Map),this.EventTask.get(h)?.get(v)||this.EventTask.get(h)?.set(v,new Map),this.EventTask.get(h)?.get(v)?.set(a,C),this.CreatListenerFunction(h),p=await this.CreatEventFunction(e)(...r)})}}class Q{core;constructor(e){this.core=e}async copyFile(e,t){await this.core.util.copyFile(e,t)}async getFileSize(e){return await this.core.util.getFileSize(e)}async getVideoUrl(e,t){return(await this.core.session.getRichMediaService().getVideoPlayUrlV2({chatType:e.chatType,peerUid:e.peerUid,guildId:"0"},e.msgId,t.elementId,0,{downSourceType:1,triggerType:1})).urlResult.domainUrl[0].url}}class B{core;constructor(e){this.core=e}async setCacheSilentScan(e=!0){return""}getCacheSessionPathList(){return""}clearCache(e=["tmp","hotUpdate"]){return this.core.session.getStorageCleanService().clearCacheDataByKeys(e)}addCacheScannedPaths(e={}){return this.core.session.getStorageCleanService().addCacheScanedPaths(e)}scanCache(){return this.core.session.getStorageCleanService().scanCache()}getHotUpdateCachePath(){return""}getDesktopTmpPath(){return""}getChatCacheList(e,t=1e3,n=0){return this.core.session.getStorageCleanService().getChatCacheInfo(e,t,1,n)}getFileCacheInfo(e,t=1e3,n){}async clearChatCache(e=[],t=[]){return this.core.session.getStorageCleanService().clearChatCacheInfo(e,t)}}class K{core;constructor(e){this.core=e}async isBuddy(e){return this.core.session.getBuddyService().isBuddy(e)}async getFriends(e=!1){let[t,n]=await this.core.event.CallNormalEvent("NodeIKernelBuddyService/getBuddyList","NodeIKernelBuddyListener/onBuddyListChange",1,5e3,()=>!0,e);const s=[];for(const o of n)for(const r of o.buddyList)s.push(r);return s}async handleFriendRequest(e,t){let n=e.split("|");if(n.length<2)return;let s=n[0],o=n[1];this.core.session.getBuddyService()?.approvalFriendRequest({friendUid:s,reqTime:o,accept:t})}}var U=(c=>(c[c.DEFAULTTYPE=0]="DEFAULTTYPE",c[c.TITLETYPE=1]="TITLETYPE",c[c.NEWGROUPTYPE=2]="NEWGROUPTYPE",c))(U||{});class O{core;constructor(e){this.core=e}async getGroups(e=!1){let[t,n,s]=await this.core.event.CallNormalEvent("NodeIKernelGroupService/getGroupList","NodeIKernelGroupListener/onGroupListUpdate",1,5e3,()=>!0,e);return s}async getGroupRecommendContactArkJson(e){return this.core.session.getGroupService().getGroupRecommendContactArkJson(e)}async CreatGroupFileFolder(e,t){return this.core.session.getRichMediaService().createGroupFolder(e,t)}async DelGroupFile(e,t){return this.core.session.getRichMediaService().deleteGroupFile(e,[102],t)}async DelGroupFileFolder(e,t){return this.core.session.getRichMediaService().deleteGroupFolder(e,t)}async getSingleScreenNotifies(e){let[t,n,s,o]=await this.core.event.CallNormalEvent("NodeIKernelGroupService/getSingleScreenNotifies","NodeIKernelGroupListener/onGroupSingleScreenNotifies",1,5e3,()=>!0,!1,"",e);return o}async getGroupMembers(e,t=3e3){const n=this.core.session.getGroupService(),s=n.createMemberListScene(e,"groupMemberList_MainWindow"),o=await n.getNextMemberList(s,void 0,t);if(o.errCode!==0)throw"获取群成员列表出错,"+o.errMsg;return o.result.infos}async getGroupNotifies(){}async GetGroupFileCount(e){return this.core.session.getRichMediaService().batchGetGroupFileCount(e)}async getGroupIgnoreNotifies(){}async getArkJsonGroupShare(e){return(await this.core.event.CallNoListenerEvent("NodeIKernelGroupService/getGroupRecommendContactArkJson",5e3,e)).arkJson}async handleGroupRequest(e,t,n){return this.core.session.getGroupService().operateSysNotify(!1,{operateType:t,targetMsg:{seq:e.seq,type:e.type,groupCode:e.group.groupCode,postscript:n||""}})}async quitGroup(e){return this.core.session.getGroupService().quitGroup(e)}async kickMember(e,t,n=!1,s=""){return this.core.session.getGroupService().kickMember(e,t,n,s)}async banMember(e,t){return this.core.session.getGroupService().setMemberShutUp(e,t)}async banGroup(e,t){return this.core.session.getGroupService().setGroupShutUp(e,t)}async setMemberCard(e,t,n){return this.core.session.getGroupService().modifyMemberCardName(e,t,n)}async setMemberRole(e,t,n){return this.core.session.getGroupService().modifyMemberRole(e,t,n)}async setGroupName(e,t){return this.core.session.getGroupService().modifyGroupName(e,t,!1)}async setGroupTitle(e,t,n){}async getGroupRemainAtTimes(e){this.core.session.getGroupService().getGroupRemainAtTimes(e)}async getMemberExtInfo(e,t){return this.core.session.getGroupService().getMemberExtInfo({groupCode:e,sourceType:U.TITLETYPE,beginUin:"0",dataTime:"0",uinList:[t],uinNum:"",seq:"",groupType:"",richCardNameVer:"",memberExtFilter:{memberLevelInfoUin:1,memberLevelInfoPoint:1,memberLevelInfoActiveDay:1,memberLevelInfoLevel:1,memberLevelInfoName:1,levelName:1,dataTime:1,userShowFlag:1,sysShowFlag:1,timeToUpdate:1,nickName:1,specialTitle:1,levelNameNew:1,userShowFlagNew:1,msgNeedField:1,cmdUinFlagExt3Grocery:1,memberIcon:1,memberInfoSeq:1}})}}class W{core;constructor(e){this.core=e}async setEmojiLike(e,t,n,s=!0){return n=n.toString(),this.core.session.getMsgService().setMsgEmojiLikes(e,t,n,n.length>3?"2":"1",s)}async getMultiMsg(e,t,n){return this.core.session.getMsgService().getMultiMsg(e,t,n)}async getMsgsByMsgId(e,t){return await this.core.session.getMsgService().getMsgsByMsgId(e,t)}async getMsgsBySeqAndCount(e,t,n,s,o){return await this.core.session.getMsgService().getMsgsBySeqAndCount(e,t,n,s,o)}async activateChat(e){}async activateChatAndGetHistory(e){}async sendMsgExtend(e,t){let n=this.core.session.getMsgService().getMsgUniqueId(Date.now().toString());return this.core.session.getMsgService().sendMsg(n,e,t,new Map)}async setMsgRead(e){return this.core.session.getMsgService().setMsgRead(e)}async getMsgHistory(e,t,n){return this.core.session.getMsgService().getMsgsIncludeSelf(e,t,n,!0)}async fetchRecentContact(){}async recallMsg(e,t){await this.core.session.getMsgService().recallMsg({chatType:e.chatType,peerUid:e.peerUid},t)}async forwardMsg(e,t,n){return this.core.session.getMsgService().forwardMsg(n,e,[t],new Map)}}class m{static async HttpsGetCookies(e){const t=e.startsWith("https")?F:A;return new Promise((n,s)=>{t.get(e,r=>{let i={};const l=a=>{if(a.statusCode===301||a.statusCode===302)if(a.headers.location){const g=new URL(a.headers.location,e);m.HttpsGetCookies(g.href).then(u=>{i={...i,...u},n(i)}).catch(u=>{s(u)})}else n(i);else n(i)};r.on("data",()=>{}),r.on("end",()=>{l(r)}),r.headers["set-cookie"]&&r.headers["set-cookie"].forEach(a=>{const g=a.split(";")[0].split("="),u=g[0],p=g[1];u&&p&&u.length>0&&p.length>0&&(i[u]=p)})}).on("error",r=>{s(r)})})}static async HttpGetJson(e,t="GET",n,s={},o=!0,r=!0){const i=new URL(e),l=e.startsWith("https://")?F:A,a={hostname:i.hostname,port:i.port,path:i.href,method:t,headers:s};return new Promise((g,u)=>{const p=l.request(a,d=>{let y="";d.on("data",f=>{y+=f.toString()}),d.on("end",()=>{try{if(d.statusCode&&d.statusCode>=200&&d.statusCode<300)if(o){const f=JSON.parse(y);g(f)}else g(y);else u(new Error(`Unexpected status code: ${d.statusCode}`))}catch(f){u(f)}})});p.on("error",d=>{u(d)}),(t==="POST"||t==="PUT"||t==="PATCH")&&(r?p.write(JSON.stringify(n)):p.write(n)),p.end()})}static async HttpGetText(e,t="GET",n,s={}){return this.HttpGetJson(e,t,n,s,!1,!1)}static async createFormData(e,t){let n="image/png";t.endsWith(".jpg")&&(n="image/jpeg");const s=[`------${e}\r
`,`Content-Disposition: form-data; name="share_image"; filename="${t}"\r
`,"Content-Type: "+n+`\r
\r
`],o=_.readFileSync(t),r=`\r
------${e}--`;return Buffer.concat([Buffer.from(s.join(""),"utf8"),o,Buffer.from(r,"utf8")])}}class J{core;constructor(e){this.core=e}async setLongNick(e){return this.core.session.getProfileService().setLongNick(e)}async setSelfOnlineStatus(e,t,n){return this.core.session.getMsgService().setStatus({status:e,extStatus:t,batteryStatus:n})}async getBuddyRecommendContactArkJson(e,t=""){return this.core.session.getBuddyService().getBuddyRecommendContactArkJson(e,t)}async like(e,t=1){return this.core.session.getProfileLikeService().setBuddyProfileLike({friendUid:e,sourceId:71,doLikeCount:t,doLikeTollCount:0})}async setQQAvatar(e){const t=await this.core.session.getProfileService().setHeader(e);return{result:t?.result,errMsg:t?.errMsg}}async getSelfInfo(){}async getUserInfo(e){}async modifySelfProfile(e){return this.core.session.getProfileService().modifyDesktopMiniProfile(e)}async getPSkey(e){return await this.core.session.getTipOffService().getPskey(e,!0)}async getQzoneCookies(e,t){const n="https://ssl.ptlogin2.qq.com/jump?ptlang=1033&clientuin="+e+"&clientkey="+t+"&u1=https%3A%2F%2Fuser.qzone.qq.com%2F"+e+"%2Finfocenter&keyindex=19%27";return await m.HttpsGetCookies(n)}async getSkey(e,t){const n="https://ssl.ptlogin2.qq.com/jump?ptlang=1033&clientuin="+e+"&clientkey="+t+"&u1=https%3A%2F%2Fh5.qzone.qq.com%2Fqqnt%2Fqzoneinpcqq%2Ffriend%3Frefresh%3D0%26clientuin%3D0%26darkMode%3D0&keyindex=19%27",o=(await m.HttpsGetCookies(n)).skey;if(!o)throw new Error("getSkey Skey is Empty");return o}async getRobotUinRange(){return(await this.core.session.getRobotService().getRobotUinRange({justFetchMsgConfig:"1",type:1,version:0,aioKeywordVersion:0}))?.response?.robotUinRanges}async getUidByUin(e){return(await this.core.event.CallNoListenerEvent("NodeIKernelUixConvertService/getUid",5e3,[e])).uidInfo.get(e)}async getUinByUid(e){return e?(await this.core.event.CallNoListenerEvent("NodeIKernelUixConvertService/getUin",5e3,[e])).uinInfo.get(e):""}async getUserDetailInfo(e){let[t,n]=await this.core.event.CallNormalEvent("NodeIKernelProfileService/getUserDetailInfo","NodeIKernelProfileListener/onProfileDetailInfoChanged",2,5e3,s=>s.uid===e,e);return n}static async getCookies(e,t,n){const s="https://ssl.ptlogin2.qq.com/jump?ptlang=1033&clientuin="+e+"&clientkey="+t+"&u1=https%3A%2F%2F"+n+"%2F"+e+"%2Finfocenter&keyindex=19%27";return await m.HttpsGetCookies(s)}async getUserDetailInfoByUin(e){return this.core.event.CallNoListenerEvent("NodeIKernelProfileService/getUserDetailInfoByUin",5e3,e)}async forceFetchClientKey(){return await this.core.session.getTicketService().forceFetchClientKey("")}}class H{async getGroupEssenceMsg(e,t,n,s){const o="https://qun.qq.com/cgi-bin/group_digest/digest_list?bkn="+s+"&group_code="+e+"&page_start="+t+"&page_limit=20";let r;try{r=await m.HttpGetJson(o,"GET","",{Cookie:n})}catch{return}if(r.retcode===0)return r}async getGroupMembers(e,t,n){let s=new Array;try{const o=[],r=await m.HttpGetJson("https://qun.qq.com/cgi-bin/qun_mgr/search_group_members?st=0&end=40&sort=1&gc="+e+"&bkn="+n,"POST","",{Cookie:t});if(!r?.count||r?.errcode!==0||!r?.mems)return[];for(const l in r.mems)s.push(r.mems[l]);const i=Math.ceil(r.count/40);for(let l=2;l<=i;l++){const a=m.HttpGetJson("https://qun.qq.com/cgi-bin/qun_mgr/search_group_members?st="+(l-1)*40+"&end="+l*40+"&sort=1&gc="+e+"&bkn="+n,"POST","",{Cookie:t});o.push(a)}for(let l=1;l<=i;l++){const a=await o[l];if(!(!a?.count||a?.errcode!==0||!a?.mems))for(const g in a.mems)s.push(a.mems[g])}}catch{return s}return s}async setGroupNotice(e,t="",n,s){let o;const r="https://web.qun.qq.com/cgi-bin/announce/add_qun_notice?bkn="+s;try{return o=await m.HttpGetJson(r,"GET","",{Cookie:n}),o}catch{return}}async getGrouptNotice(e,t,n){let s;const o="https://web.qun.qq.com/cgi-bin/announce/get_t_list?bkn="+n+"&qid="+e+"&ft=23&ni=1&n=1&i=1&log_read=1&platform=1&s=-1&n=20";try{return s=await m.HttpGetJson(o,"GET","",{Cookie:t}),s?.ec!==0?void 0:s}catch{return}}genBkn(e){e=e||"";let t=5381;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=t+(t<<5)+s}return(t&2147483647).toString()}async getGroupHonorInfo(e,t,n){async function s(r,i){let l="https://qun.qq.com/interactive/honorlist?gc="+r+"&type="+i.toString(),a="",g;try{a=await m.HttpGetText(l,"GET","",{Cookie:n});const u=a.match(/window\.__INITIAL_STATE__=(.*?);/);return u&&(g=JSON.parse(u[1].trim())),i===1?g?.talkativeList:g?.actorList}catch{}}let o={group_id:e};if(t==="talkative"||t==="all")try{let r=await s(e,1);if(!r)throw new Error("获取龙王信息失败");o.current_talkative={user_id:r[0]?.uin,avatar:r[0]?.avatar,nickname:r[0]?.name,day_count:0,description:r[0]?.desc},o.talkative_list=[];for(const i of r)o.talkative_list.push({user_id:i?.uin,avatar:i?.avatar,description:i?.desc,day_count:0,nickname:i?.name})}catch{}if(t==="performer"||t==="all")try{let r=await s(e,2);if(!r)throw new Error("获取群聊之火失败");o.performer_list=[];for(const i of r)o.performer_list.push({user_id:i?.uin,nickname:i?.name,avatar:i?.avatar,description:i?.desc})}catch{}if(t==="performer"||t==="all")try{let r=await s(e,3);if(!r)throw new Error("获取群聊炽焰失败");o.legend_list=[];for(const i of r)o.legend_list.push({user_id:i?.uin,nickname:i?.name,avatar:i?.avatar,desc:i?.description})}catch{}if(t==="emotion"||t==="all")try{let r=await s(e,6);if(!r)throw new Error("获取快乐源泉失败");o.emotion_list=[];for(const i of r)o.emotion_list.push({user_id:i?.uin,nickname:i?.name,avatar:i?.avatar,desc:i?.description})}catch{}return(t==="emotion"||t==="all")&&(o.strong_newbie_list=[]),o}}class x{core;constructor(e){this.core=e}async hasOtherRunningQQProcess(){return this.core.util.hasOtherRunningQQProcess()}async ORCImage(e){return this.core.session.getNodeMiscService().wantWinScreenOCR(e)}async translateEnWordToZn(e){return this.core.session.getRichMediaService().translateEnWordToZn(e)}async getOnlineDev(){return this.core.session.getMsgService().getOnLineDev()}async getArkJsonCollection(e){return await this.core.event.CallNoListenerEvent("NodeIKernelCollectionService/collectionArkShare",5e3,"1717662698058")}async BootMiniApp(e,t){await this.core.session.getNodeMiscService().setMiniAppVersion("2.16.4");let n=await this.core.session.getNodeMiscService().getMiniAppPath();return console.log(n),this.core.session.getNodeMiscService().startNewMiniApp(e,t)}}class ${core;constructor(e){this.core=e}async createCollection(e,t,n,s,o){let r={commInfo:{bid:1,category:2,author:{type:1,numId:e,strId:n,groupId:"0",groupName:"",uid:t},customGroupId:"0",createTime:Date.now().toString(),sequence:Date.now().toString()},richMediaSummary:{originalUri:"",publisher:"",richMediaVersion:0,subTitle:"",title:"",brief:s,picList:[],contentType:1},richMediaContent:{rawData:o,bizDataList:[],picList:[],fileList:[]},need_share_url:!1};return this.core.session.getCollectionService().createNewCollectionItem(r)}async getAllCollection(e=0,t=50){let n={category:e,groupId:-1,forceSync:!0,forceFromDb:!1,timeStamp:"0",count:t,searchDown:!0};return this.core.session.getCollectionService().getCollectionItemList(n)}}class b{session;util;event;ApiCollection;ApiFile;ApiFileCache;ApiFriend;ApiGroup;ApiMsg;ApiSystem;ApiUser;ApiWeb;constructor(e,t){this.session=t,this.util=new e.NodeQQNTWrapperUtil,this.event=new D,this.event.init({ListenerMap:e,WrapperSession:this.session}),this.ApiCollection=new $(this),this.ApiFile=new Q(this),this.ApiFileCache=new B(this),this.ApiFriend=new K(this),this.ApiGroup=new O(this),this.ApiMsg=new W(this),this.ApiSystem=new x(this),this.ApiUser=new J(this),this.ApiWeb=new H}getWrapperSession(){return this.session}getWrapperUtil(){return this.util}getApiCollection(){return this.ApiCollection}getApiFile(){return this.ApiFile}getApiFileCache(){return this.ApiFileCache}getApiFriend(){return this.ApiFriend}getApiGroup(){return this.ApiGroup}getApiMsg(){return this.ApiMsg}getApiSystem(){return this.ApiSystem}getApiUser(){return this.ApiUser}getApiWeb(){return this.ApiWeb}}class j{onLoginConnected(...e){}onLoginDisConnected(...e){}onLoginConnecting(...e){}onQRCodeGetPicture(e){}onQRCodeLoginPollingStarted(...e){}onQRCodeSessionUserScaned(...e){}onQRCodeLoginSucceed(e){}onQRCodeSessionFailed(...e){}onLoginFailed(...e){}onLogoutSucceed(...e){}onLogoutFailed(...e){}onUserLoggedIn(...e){}onQRCodeSessionQuickLoginFailed(...e){}onPasswordLoginFailed(...e){}OnConfirmUnusualDeviceFailed(...e){}onQQLoginNumLimited(...e){}onLoginState(...e){}}const q=new E.EventEmitter;let S;const M=(c,e,t)=>{t&&console.log(`==============${t}被调用=============`),e.length&&(console.log("参数:"),console.log(JSON.stringify(e))),console.log("返回值:"),console.log(JSON.stringify(c)),typeof c=="object"&&(console.log("原型对象:"),console.log(Object.getPrototypeOf(c)))},I=({instance:c,rootName:e,log:t,eventBlacklist:n,eventListeners:s,eventInterceptors:o})=>{const r=Object.getPrototypeOf(c);for(const i of Object.getOwnPropertyNames(r)){if(typeof r[i]!="function")continue;const l=`${e}.${i}`;c[i]=function(...a){if(n?.includes(l))return;const g=o?.[l]?.(a)??a,u=r[i].apply(this,g);if(u instanceof Promise)u.then(p=>{const d={ret:p,params:a};t&&M(p,a,l),s?.[l]?.(d),q?.emit(l,d)});else{const p={ret:u,params:a};t&&M(u,a,l),s?.[l]?.(p),q?.emit(l,p)}return i.includes("Service")&&I({instance:u,rootName:`${l}`,log:t,eventBlacklist:n,eventListeners:s,eventInterceptors:o}),u}}return c},N=new Map,z=c=>new Promise(e=>{T.dlopen=new Proxy(T.dlopen,{apply(t,n,s){const o=Reflect.apply(t,n,s),[,r]=s;if(r.includes("wrapper.node")){const i=s[0].exports;s[0].exports=new Proxy(i,{get(l,a,g){return typeof l[a]!="function"?Reflect.get(l,a,g):new Proxy(l[a],{construct(u,p){const d=N.get(a),y=!d&&c.log;y&&console.log(`--------------------- ${a}被构造 ---------------------`);const f={rootName:a,log:c.log,eventBlacklist:c.eventBlacklist,eventListeners:c.eventListeners,eventInterceptors:c.eventInterceptors};p.length&&(y&&(console.log("构造参数:"),console.log(p)),typeof p[0]=="object"&&p[0]&&(p[0]=I({...f,instance:Object.create(p[0])})));const h=Reflect.construct(u,p);if(Object.getOwnPropertyNames(h).length===0&&I({...f,instance:h}),!d&&N.set(a,h),a==="NodeIQQNTWrapperSession"&&S&&!c.waitLogin){const v=new b(S,h);e(v)}if(a==="NodeIKernelLoginService"&&S&&c.waitLogin){const v=h,C=new j;C.onQRCodeLoginSucceed=()=>{const G=new b(S,N.get("NodeIQQNTWrapperSession"));e(G)},v.addKernelLoginListener(new S.NodeIKernelLoginListener(C))}return y&&M(h,[]),h}})}}),S=i}return o}})});var L=(c=>(c.sendLog="NodeIQQNTWrapperSession.getNodeMiscService.sendLog",c.requestTianshuAdv="NodeIQQNTWrapperSession.getMsgService.requestTianshuAdv",c.onQRCodeLoginSucceed="NodeIKernelLoginListener.onQRCodeLoginSucceed",c.onUserDetailInfoChanged="NodeIKernelProfileListener.onUserDetailInfoChanged",c.getLoginList="NodeIKernelLoginService.getLoginList",c.onRecvMsg="NodeIKernelMsgListener.onRecvMsg",c.onUnitedConfigUpdate="NodeIKernelUnitedConfigListener.onUnitedConfigUpdate",c))(L||{});const w=new E.EventEmitter,k=new Map,Y=(c,e)=>{c.webContents.send=new Proxy(c.webContents.send,{apply(t,n,s){const[o]=s;if(!o.includes("IPC"))return Reflect.apply(t,n,s);let r;if(s[1].type==="request"){const[,,[{cmdName:i,payload:l}]]=s;r=e?.eventInterceptors?.[i](s);const a=r?.[2][0].payload;w.emit(i,a??l)}else{const[,{callbackId:i},l]=s,a=k.get(i);k.delete(i),a&&e?.eventInterceptors?.[`${a}:response`]&&(r=e?.eventInterceptors?.[`${a}:response`](s));const g=r?.[2];w.emit(i,g??l)}return Reflect.apply(t,n,r??s)}}),c.webContents._events["-ipc-message"]=new Proxy(c.webContents._events["-ipc-message"],{apply(t,n,s){const[,,,[{type:o}]]=s;let r;if(o==="request"){const[,,,[{callbackId:i,eventName:l},[a]]]=s;if(l.includes("ns-LoggerApi"))return;const g=typeof a=="string"?a:l;k.set(i,g),r=e?.eventInterceptors?.[g](s),w.once(i,u=>{w.emit(g,u)})}return Reflect.apply(t,n,r??s)}})};(async()=>await z({log:!1,eventBlacklist:[L.sendLog,L.requestTianshuAdv,L.onUnitedConfigUpdate],waitLogin:!0}))();exports.onBrowserWindowCreated=c=>{Y(c)};
